#!/bin/sh
#
# Wrapper that only allows certbot certonly on the MASTER node.

ROLE_FILE="/var/run/haproxy_role"

if [ ! -f "${ROLE_FILE}" ] || ! grep -qi "master" "${ROLE_FILE}" 2>/dev/null; then
    echo "[INFO] certbot-certonly: Node is not MASTER (role from ${ROLE_FILE}), skipping certbot certonly." >&2
    exit 0
fi

# Pass all arguments through to certbot certonly
exec /usr/bin/certbot certonly "$@"
